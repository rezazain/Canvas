{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect, useRef } from \"react\";\nexport function useOnDraw(onDraw) {\n  _s();\n\n  const canvasRef = useRef(null);\n  const isDrawingRef = useRef(false);\n  const prevPointRef = useRef(null);\n  const mouseMoveListenerRef = useRef(null);\n  const mouseUpListenerRef = useRef(null);\n\n  function setCanvasRef(ref) {\n    canvasRef.current = ref;\n  }\n\n  function onCanvasMouseDown() {\n    isDrawingRef.current = true;\n  }\n\n  useEffect(() => {\n    function computePointInCanvas(clientX, clientY) {\n      if (canvasRef.current) {\n        const boundingRect = canvasRef.current.getBoundingClientRect();\n        return {\n          x: clientX - boundingRect.left,\n          y: clientY - boundingRect.top\n        };\n      } else {\n        return null;\n      }\n    }\n\n    function initMouseMoveListener() {\n      const mouseMoveListener = e => {\n        if (isDrawingRef.current && canvasRef.current) {\n          const point = computePointInCanvas(e.clientX, e.clientY);\n          const ctx = canvasRef.current.getContext(\"2d\");\n          if (onDraw) onDraw(ctx, point, prevPointRef.current);\n          prevPointRef.current = point;\n          console.log(point);\n        }\n      };\n\n      mouseMoveListenerRef.current = mouseMoveListener;\n      window.addEventListener(\"mousemove\", mouseMoveListener);\n    }\n\n    function initMouseUpListener() {\n      const listener = () => {\n        isDrawingRef.current = false;\n        prevPointRef.current = null;\n      };\n\n      mouseUpListenerRef.current = listener;\n      window.addEventListener(\"mouseup\", listener);\n    }\n\n    function cleanup() {\n      if (mouseMoveListenerRef.current) {\n        window.removeEventListener(\"mousemove\", mouseMoveListenerRef.current);\n      }\n\n      if (mouseUpListenerRef.current) {\n        window.removeEventListener(\"mouseup\", mouseUpListenerRef.current);\n      }\n    }\n\n    initMouseMoveListener();\n    initMouseUpListener();\n    return () => cleanup();\n  }, [onDraw]);\n  return {\n    setCanvasRef,\n    onCanvasMouseDown\n  };\n}\n\n_s(useOnDraw, \"yzQlUgpjSmNqxYCWmikAILNmSuw=\");","map":{"version":3,"names":["useEffect","useRef","useOnDraw","onDraw","canvasRef","isDrawingRef","prevPointRef","mouseMoveListenerRef","mouseUpListenerRef","setCanvasRef","ref","current","onCanvasMouseDown","computePointInCanvas","clientX","clientY","boundingRect","getBoundingClientRect","x","left","y","top","initMouseMoveListener","mouseMoveListener","e","point","ctx","getContext","console","log","window","addEventListener","initMouseUpListener","listener","cleanup","removeEventListener"],"sources":["/home/reza/Documents/MiniApp/canvas/src/components/hooks.js"],"sourcesContent":["import { useEffect, useRef } from \"react\";\n\nexport function useOnDraw(onDraw) {\n  const canvasRef = useRef(null);\n  const isDrawingRef = useRef(false);\n  const prevPointRef = useRef(null);\n\n  const mouseMoveListenerRef = useRef(null);\n  const mouseUpListenerRef = useRef(null);\n\n  function setCanvasRef(ref) {\n    canvasRef.current = ref;\n  }\n\n  function onCanvasMouseDown() {\n    isDrawingRef.current = true;\n  }\n\n  useEffect(() => {\n    function computePointInCanvas(clientX, clientY) {\n      if (canvasRef.current) {\n        const boundingRect = canvasRef.current.getBoundingClientRect();\n        return {\n          x: clientX - boundingRect.left,\n          y: clientY - boundingRect.top,\n        };\n      } else {\n        return null;\n      }\n    }\n    function initMouseMoveListener() {\n      const mouseMoveListener = (e) => {\n        if (isDrawingRef.current && canvasRef.current) {\n          const point = computePointInCanvas(e.clientX, e.clientY);\n          const ctx = canvasRef.current.getContext(\"2d\");\n          if (onDraw) onDraw(ctx, point, prevPointRef.current);\n          prevPointRef.current = point;\n          console.log(point);\n        }\n      };\n      mouseMoveListenerRef.current = mouseMoveListener;\n      window.addEventListener(\"mousemove\", mouseMoveListener);\n    }\n\n    function initMouseUpListener() {\n      const listener = () => {\n        isDrawingRef.current = false;\n        prevPointRef.current = null;\n      };\n      mouseUpListenerRef.current = listener;\n      window.addEventListener(\"mouseup\", listener);\n    }\n\n    function cleanup() {\n      if (mouseMoveListenerRef.current) {\n        window.removeEventListener(\"mousemove\", mouseMoveListenerRef.current);\n      }\n      if (mouseUpListenerRef.current) {\n        window.removeEventListener(\"mouseup\", mouseUpListenerRef.current);\n      }\n    }\n\n    initMouseMoveListener();\n    initMouseUpListener();\n    return () => cleanup();\n  }, [onDraw]);\n\n  return {\n    setCanvasRef,\n    onCanvasMouseDown,\n  };\n}\n"],"mappings":";;AAAA,SAASA,SAAT,EAAoBC,MAApB,QAAkC,OAAlC;AAEA,OAAO,SAASC,SAAT,CAAmBC,MAAnB,EAA2B;EAAA;;EAChC,MAAMC,SAAS,GAAGH,MAAM,CAAC,IAAD,CAAxB;EACA,MAAMI,YAAY,GAAGJ,MAAM,CAAC,KAAD,CAA3B;EACA,MAAMK,YAAY,GAAGL,MAAM,CAAC,IAAD,CAA3B;EAEA,MAAMM,oBAAoB,GAAGN,MAAM,CAAC,IAAD,CAAnC;EACA,MAAMO,kBAAkB,GAAGP,MAAM,CAAC,IAAD,CAAjC;;EAEA,SAASQ,YAAT,CAAsBC,GAAtB,EAA2B;IACzBN,SAAS,CAACO,OAAV,GAAoBD,GAApB;EACD;;EAED,SAASE,iBAAT,GAA6B;IAC3BP,YAAY,CAACM,OAAb,GAAuB,IAAvB;EACD;;EAEDX,SAAS,CAAC,MAAM;IACd,SAASa,oBAAT,CAA8BC,OAA9B,EAAuCC,OAAvC,EAAgD;MAC9C,IAAIX,SAAS,CAACO,OAAd,EAAuB;QACrB,MAAMK,YAAY,GAAGZ,SAAS,CAACO,OAAV,CAAkBM,qBAAlB,EAArB;QACA,OAAO;UACLC,CAAC,EAAEJ,OAAO,GAAGE,YAAY,CAACG,IADrB;UAELC,CAAC,EAAEL,OAAO,GAAGC,YAAY,CAACK;QAFrB,CAAP;MAID,CAND,MAMO;QACL,OAAO,IAAP;MACD;IACF;;IACD,SAASC,qBAAT,GAAiC;MAC/B,MAAMC,iBAAiB,GAAIC,CAAD,IAAO;QAC/B,IAAInB,YAAY,CAACM,OAAb,IAAwBP,SAAS,CAACO,OAAtC,EAA+C;UAC7C,MAAMc,KAAK,GAAGZ,oBAAoB,CAACW,CAAC,CAACV,OAAH,EAAYU,CAAC,CAACT,OAAd,CAAlC;UACA,MAAMW,GAAG,GAAGtB,SAAS,CAACO,OAAV,CAAkBgB,UAAlB,CAA6B,IAA7B,CAAZ;UACA,IAAIxB,MAAJ,EAAYA,MAAM,CAACuB,GAAD,EAAMD,KAAN,EAAanB,YAAY,CAACK,OAA1B,CAAN;UACZL,YAAY,CAACK,OAAb,GAAuBc,KAAvB;UACAG,OAAO,CAACC,GAAR,CAAYJ,KAAZ;QACD;MACF,CARD;;MASAlB,oBAAoB,CAACI,OAArB,GAA+BY,iBAA/B;MACAO,MAAM,CAACC,gBAAP,CAAwB,WAAxB,EAAqCR,iBAArC;IACD;;IAED,SAASS,mBAAT,GAA+B;MAC7B,MAAMC,QAAQ,GAAG,MAAM;QACrB5B,YAAY,CAACM,OAAb,GAAuB,KAAvB;QACAL,YAAY,CAACK,OAAb,GAAuB,IAAvB;MACD,CAHD;;MAIAH,kBAAkB,CAACG,OAAnB,GAA6BsB,QAA7B;MACAH,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmCE,QAAnC;IACD;;IAED,SAASC,OAAT,GAAmB;MACjB,IAAI3B,oBAAoB,CAACI,OAAzB,EAAkC;QAChCmB,MAAM,CAACK,mBAAP,CAA2B,WAA3B,EAAwC5B,oBAAoB,CAACI,OAA7D;MACD;;MACD,IAAIH,kBAAkB,CAACG,OAAvB,EAAgC;QAC9BmB,MAAM,CAACK,mBAAP,CAA2B,SAA3B,EAAsC3B,kBAAkB,CAACG,OAAzD;MACD;IACF;;IAEDW,qBAAqB;IACrBU,mBAAmB;IACnB,OAAO,MAAME,OAAO,EAApB;EACD,CA/CQ,EA+CN,CAAC/B,MAAD,CA/CM,CAAT;EAiDA,OAAO;IACLM,YADK;IAELG;EAFK,CAAP;AAID;;GArEeV,S"},"metadata":{},"sourceType":"module"}