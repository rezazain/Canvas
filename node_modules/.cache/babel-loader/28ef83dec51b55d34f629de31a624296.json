{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useRef } from \"react\";\nexport function useOnDraw(onDraw) {\n  _s();\n\n  const canvasRef = useRef(null);\n  const isDrawingRef = useRef(false);\n  const prevPointRef = useRef(null);\n  const mouseMoveListenerRef = useRef(null);\n  const mouseUpListenerRef = useRef(null);\n\n  function setCanvasRef(ref) {\n    canvasRef.current = ref;\n  }\n\n  function onCanvasMouseDown() {\n    isDrawingRef.current = true;\n  }\n\n  useEffect(() => {\n    function computePointInCanvas(clientX, clientY) {\n      if (canvasRef.current) {\n        const boundingRect = canvasRef.current.getBoundingClientRect();\n        return {\n          x: clientX - boundingRect.left,\n          y: clientY - boundingRect.top\n        };\n      } else {\n        return null;\n      }\n    }\n\n    function initMouseMoveListener() {\n      const mouseMoveListener = e => {\n        if (isDrawingRef.current && canvasRef.current) {\n          const point = computePointInCanvas(e.clientX, e.clientY);\n          const ctx = canvasRef.current.getContext('2d');\n          if (onDraw) onDraw(ctx, point, prevPointRef.current);\n          prevPointRef.current = point;\n          console.log(point);\n        }\n      };\n\n      mouseMoveListenerRef.current = mouseMoveListener;\n      window.addEventListener(\"mousemove\", mouseMoveListener);\n    }\n\n    function initMouseUpListener() {\n      const listener = () => {\n        isDrawingRef.current = false;\n        prevPointRef.current = null;\n      };\n\n      mouseUpListenerRef.current = listener;\n      window.addEventListener(\"mouseup\", listener);\n    }\n\n    function cleanup() {\n      if (mouseMoveListenerRef.current) {\n        window.removeEventListener(\"mousemove\", mouseMoveListenerRef.current);\n      }\n\n      if (mouseUpListenerRef.current) {\n        window.removeEventListener(\"mouseup\", mouseUpListenerRef.current);\n      }\n    }\n\n    initMouseMoveListener();\n    initMouseUpListener();\n    return () => cleanup();\n  }, [onDraw]);\n  return {\n    setCanvasRef,\n    onCanvasMouseDown\n  };\n}\n\n_s(useOnDraw, \"yzQlUgpjSmNqxYCWmikAILNmSuw=\");\n\n;","map":{"version":3,"names":["useRef","useOnDraw","onDraw","canvasRef","isDrawingRef","prevPointRef","mouseMoveListenerRef","mouseUpListenerRef","setCanvasRef","ref","current","onCanvasMouseDown","useEffect","computePointInCanvas","clientX","clientY","boundingRect","getBoundingClientRect","x","left","y","top","initMouseMoveListener","mouseMoveListener","e","point","ctx","getContext","console","log","window","addEventListener","initMouseUpListener","listener","cleanup","removeEventListener"],"sources":["/home/reza/Documents/MiniApp/canvas/src/components/hooks.js"],"sourcesContent":["import { useRef } from \"react\";\n\nexport function useOnDraw(onDraw) {\n\n  const canvasRef = useRef(null);\n  const isDrawingRef = useRef(false);\n  const prevPointRef = useRef(null);\n\n  const mouseMoveListenerRef = useRef(null);\n  const mouseUpListenerRef = useRef(null);\n\n  function setCanvasRef(ref) {\n      canvasRef.current = ref;\n  }\n\n  function onCanvasMouseDown() {\n      isDrawingRef.current = true;\n  }\n\n  useEffect(() => {\n      function computePointInCanvas(clientX, clientY) {\n          if (canvasRef.current) {\n              const boundingRect = canvasRef.current.getBoundingClientRect();\n              return {\n                  x: clientX - boundingRect.left,\n                  y: clientY - boundingRect.top\n              }\n          } else {\n              return null;\n          }\n\n      }\n      function initMouseMoveListener() {\n          const mouseMoveListener = (e) => {\n              if (isDrawingRef.current && canvasRef.current) {\n                  const point = computePointInCanvas(e.clientX, e.clientY);\n                  const ctx = canvasRef.current.getContext('2d');\n                  if (onDraw) onDraw(ctx, point, prevPointRef.current);\n                  prevPointRef.current = point;\n                  console.log(point);\n              }\n          }\n          mouseMoveListenerRef.current = mouseMoveListener;\n          window.addEventListener(\"mousemove\", mouseMoveListener);\n      }\n\n      function initMouseUpListener() {\n          const listener = () => {\n              isDrawingRef.current = false;\n              prevPointRef.current = null;\n          }\n          mouseUpListenerRef.current = listener;\n          window.addEventListener(\"mouseup\", listener);\n      }\n\n      function cleanup() {\n          if (mouseMoveListenerRef.current) {\n              window.removeEventListener(\"mousemove\", mouseMoveListenerRef.current);\n          }\n          if (mouseUpListenerRef.current) {\n              window.removeEventListener(\"mouseup\", mouseUpListenerRef.current);\n          }\n      }\n\n      initMouseMoveListener();\n      initMouseUpListener();\n      return () => cleanup();\n\n  }, [onDraw]);\n\n  return {\n      setCanvasRef,\n      onCanvasMouseDown\n  }\n\n};"],"mappings":";;AAAA,SAASA,MAAT,QAAuB,OAAvB;AAEA,OAAO,SAASC,SAAT,CAAmBC,MAAnB,EAA2B;EAAA;;EAEhC,MAAMC,SAAS,GAAGH,MAAM,CAAC,IAAD,CAAxB;EACA,MAAMI,YAAY,GAAGJ,MAAM,CAAC,KAAD,CAA3B;EACA,MAAMK,YAAY,GAAGL,MAAM,CAAC,IAAD,CAA3B;EAEA,MAAMM,oBAAoB,GAAGN,MAAM,CAAC,IAAD,CAAnC;EACA,MAAMO,kBAAkB,GAAGP,MAAM,CAAC,IAAD,CAAjC;;EAEA,SAASQ,YAAT,CAAsBC,GAAtB,EAA2B;IACvBN,SAAS,CAACO,OAAV,GAAoBD,GAApB;EACH;;EAED,SAASE,iBAAT,GAA6B;IACzBP,YAAY,CAACM,OAAb,GAAuB,IAAvB;EACH;;EAEDE,SAAS,CAAC,MAAM;IACZ,SAASC,oBAAT,CAA8BC,OAA9B,EAAuCC,OAAvC,EAAgD;MAC5C,IAAIZ,SAAS,CAACO,OAAd,EAAuB;QACnB,MAAMM,YAAY,GAAGb,SAAS,CAACO,OAAV,CAAkBO,qBAAlB,EAArB;QACA,OAAO;UACHC,CAAC,EAAEJ,OAAO,GAAGE,YAAY,CAACG,IADvB;UAEHC,CAAC,EAAEL,OAAO,GAAGC,YAAY,CAACK;QAFvB,CAAP;MAIH,CAND,MAMO;QACH,OAAO,IAAP;MACH;IAEJ;;IACD,SAASC,qBAAT,GAAiC;MAC7B,MAAMC,iBAAiB,GAAIC,CAAD,IAAO;QAC7B,IAAIpB,YAAY,CAACM,OAAb,IAAwBP,SAAS,CAACO,OAAtC,EAA+C;UAC3C,MAAMe,KAAK,GAAGZ,oBAAoB,CAACW,CAAC,CAACV,OAAH,EAAYU,CAAC,CAACT,OAAd,CAAlC;UACA,MAAMW,GAAG,GAAGvB,SAAS,CAACO,OAAV,CAAkBiB,UAAlB,CAA6B,IAA7B,CAAZ;UACA,IAAIzB,MAAJ,EAAYA,MAAM,CAACwB,GAAD,EAAMD,KAAN,EAAapB,YAAY,CAACK,OAA1B,CAAN;UACZL,YAAY,CAACK,OAAb,GAAuBe,KAAvB;UACAG,OAAO,CAACC,GAAR,CAAYJ,KAAZ;QACH;MACJ,CARD;;MASAnB,oBAAoB,CAACI,OAArB,GAA+Ba,iBAA/B;MACAO,MAAM,CAACC,gBAAP,CAAwB,WAAxB,EAAqCR,iBAArC;IACH;;IAED,SAASS,mBAAT,GAA+B;MAC3B,MAAMC,QAAQ,GAAG,MAAM;QACnB7B,YAAY,CAACM,OAAb,GAAuB,KAAvB;QACAL,YAAY,CAACK,OAAb,GAAuB,IAAvB;MACH,CAHD;;MAIAH,kBAAkB,CAACG,OAAnB,GAA6BuB,QAA7B;MACAH,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmCE,QAAnC;IACH;;IAED,SAASC,OAAT,GAAmB;MACf,IAAI5B,oBAAoB,CAACI,OAAzB,EAAkC;QAC9BoB,MAAM,CAACK,mBAAP,CAA2B,WAA3B,EAAwC7B,oBAAoB,CAACI,OAA7D;MACH;;MACD,IAAIH,kBAAkB,CAACG,OAAvB,EAAgC;QAC5BoB,MAAM,CAACK,mBAAP,CAA2B,SAA3B,EAAsC5B,kBAAkB,CAACG,OAAzD;MACH;IACJ;;IAEDY,qBAAqB;IACrBU,mBAAmB;IACnB,OAAO,MAAME,OAAO,EAApB;EAEH,CAjDQ,EAiDN,CAAChC,MAAD,CAjDM,CAAT;EAmDA,OAAO;IACHM,YADG;IAEHG;EAFG,CAAP;AAKD;;GAzEeV,S;;AAyEf"},"metadata":{},"sourceType":"module"}